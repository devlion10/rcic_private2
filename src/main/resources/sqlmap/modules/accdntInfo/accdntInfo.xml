<?xml version="1.0" encoding="UTF-8"?>
<!--
 ! Source code generated by Celerio, a Jaxio product.
 ! Documentation: http://www.jaxio.com/documentation/celerio/
 ! Follow us on twitter: @jaxiosoft
 ! Need commercial support ? Contact us: info@jaxio.com
 ! Template pack-rcic:src/main/resources/sqlmap/modules/SqlMap.e.vm.xml
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper">

    <resultMap id="accdntInfoResultMap" type="kr.or.lx.rcic.modules.accdntInfo.entity.AccdntInfo">
        <!-- 유고정보번호 -->
        <result property="id" column="accdnt_info_no"/>
        <!-- 공사사고구분 -->
        <result property="cntrwkAcdntSe" column="cntrwk_acdnt_se"/>
        <!-- 고유식별번호 -->
        <result property="esntlIdntfcNo" column="esntl_idntfc_no"/>
        <!-- 공사사고유형 -->
        <result property="cntrwkAcdntTy" column="cntrwk_acdnt_ty"/>
        <!-- 차로차단방법 -->
        <result property="cartrkIntrcpMth" column="cartrk_intrcp_mth"/>
        <!-- 차단된차로수 -->
        <result property="blockLaneCnt" column="block_lane_cnt"/>
        <!-- 공사시작일 -->
        <result property="cntrwkBgnde" column="cntrwk_bgnde"/>
        <!-- 공사종료일 -->
        <result property="cntrwkEndde" column="cntrwk_endde"/>
        <!-- 공사실제개시시간 -->
        <result property="cntrwkRealBeginTime" column="cntrwk_real_begin_time"/>
        <!-- 공사실제종료시간 -->
        <result property="cntrwkRealEndTime" column="cntrwk_real_end_time"/>
        <!-- 돌발상황지속여부 -->
        <result property="outbrkSittnCntncAt" column="outbrk_sittn_cntnc_at"/>
        <!-- 상황정보메시지 -->
        <result property="sittnInfoMssage" column="sittn_info_mssage"/>
        <!-- X좌표 -->
        <result property="utmkX" column="utmk_x"/>
        <!-- Y좌표 -->
        <result property="utmkY" column="utmk_y"/>
        <!-- 등록일시 -->
        <result property="registDt" column="regist_dt"/>
        <!-- WKT 변환좌표 (EPSG3857) -->
        <result property="wktGeom" column="wkt_geom"/>
    </resultMap>

    <sql id="whereConditions">
        <where>
            <include refid="conditions" />
        </where>
    </sql>

    <sql id="conditions">
        <if test="id != null">
            AND accdnt_info_no = #{id}
        </if>
        <if test="cntrwkAcdntSe != null and cntrwkAcdntSe != ''">
            AND cntrwk_acdnt_se = #{cntrwkAcdntSe}
        </if>
        <if test="esntlIdntfcNo != null and esntlIdntfcNo != ''">
            AND esntl_idntfc_no = #{esntlIdntfcNo}
        </if>
        <if test="cntrwkAcdntTy != null and cntrwkAcdntTy != ''">
            AND cntrwk_acdnt_ty = #{cntrwkAcdntTy}
        </if>
        <if test="cartrkIntrcpMth != null and cartrkIntrcpMth != ''">
            AND cartrk_intrcp_mth = #{cartrkIntrcpMth}
        </if>
        <if test="blockLaneCnt != null">
            AND block_lane_cnt = #{blockLaneCnt}
        </if>
        <if test="cntrwkBgnde != null and cntrwkBgnde != ''">
            AND cntrwk_bgnde = #{cntrwkBgnde}
        </if>
        <if test="cntrwkEndde != null and cntrwkEndde != ''">
            AND cntrwk_endde = #{cntrwkEndde}
        </if>
        <if test="cntrwkRealBeginTime != null and cntrwkRealBeginTime != ''">
            AND cntrwk_real_begin_time = #{cntrwkRealBeginTime}
        </if>
        <if test="cntrwkRealEndTime != null and cntrwkRealEndTime != ''">
            AND cntrwk_real_end_time = #{cntrwkRealEndTime}
        </if>
        <if test="outbrkSittnCntncAt != null and outbrkSittnCntncAt != ''">
            AND outbrk_sittn_cntnc_at = #{outbrkSittnCntncAt}
        </if>
        <if test="sittnInfoMssage != null and sittnInfoMssage != ''">
            AND sittn_info_mssage = #{sittnInfoMssage}
        </if>
        <if test="utmkX != null">
            AND utmk_x = #{utmkX}
        </if>
        <if test="utmkY != null">
            AND utmk_y = #{utmkY}
        </if>
        <if test="registDt != null and registDt.enabled == true">
            
            <if test="registDtEq != null and registDtEq != ''">
            AND regist_dt = STR_TO_DATE(#{registDtEq}, '%Y.%m.%d')
            </if>
            
            <if test="registDtFrom != null and registDtFrom != ''">
            AND regist_dt <![CDATA[ >= ]]> STR_TO_DATE(#{registDtFrom}, '%Y.%m.%d')
            </if>

            <if test="registDtTo != null and registDtTo != ''">
            AND regist_dt <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{registDtTo}, '%Y.%m.%d'), INTERVAL 1 DAY)
            </if>
        </if>
        <if test="wktGeom != null and wktGeom != ''">
            AND wkt_geom = #{wktGeom}
        </if>
    </sql>

    <select id="getAccdntInfo" resultMap="accdntInfoResultMap">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.getAccdntInfo */

        SELECT
            accdnt_info_no, cntrwk_acdnt_se, esntl_idntfc_no, cntrwk_acdnt_ty, cartrk_intrcp_mth, block_lane_cnt, cntrwk_bgnde, cntrwk_endde, cntrwk_real_begin_time, cntrwk_real_end_time, outbrk_sittn_cntnc_at, sittn_info_mssage, utmk_x, utmk_y, regist_dt, wkt_geom
        FROM rcic.tl_accdnt_info
        WHERE
         accdnt_info_no = #{id}
	</select>

    <select id="selectAccdntInfoCnt" resultType="int">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.simpleListAccdntInfoCnt */

        SELECT COUNT(*)
        FROM rcic.tl_accdnt_info
        <include refid="whereConditions" />
    </select>

    
    <select id="selectAccdntInfoList" resultType="egovMap">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.selectAccdntInfoList */

        <include refid="common.headerRow"/>
        SELECT
            accdnt_info_no, cntrwk_acdnt_se, esntl_idntfc_no, cntrwk_acdnt_ty, cartrk_intrcp_mth, block_lane_cnt, cntrwk_bgnde, cntrwk_endde, cntrwk_real_begin_time, cntrwk_real_end_time, outbrk_sittn_cntnc_at, sittn_info_mssage, utmk_x, utmk_y, regist_dt, wkt_geom
        FROM rcic.tl_accdnt_info
        <include refid="whereConditions" />
        <include refid="common.footerRow"/>
	</select>

    <update id="updateAccdntInfo" parameterType="kr.or.lx.rcic.modules.accdntInfo.entity.AccdntInfo">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.updateAccdntInfo */

        UPDATE rcic.tl_accdnt_info
        SET
               cntrwk_acdnt_se = #{cntrwkAcdntSe}
                    , esntl_idntfc_no = #{esntlIdntfcNo}
                    , cntrwk_acdnt_ty = #{cntrwkAcdntTy}
                    , cartrk_intrcp_mth = #{cartrkIntrcpMth}
                    , block_lane_cnt = #{blockLaneCnt}
                    , cntrwk_bgnde = #{cntrwkBgnde}
                    , cntrwk_endde = #{cntrwkEndde}
                    , cntrwk_real_begin_time = #{cntrwkRealBeginTime}
                    , cntrwk_real_end_time = #{cntrwkRealEndTime}
                    , outbrk_sittn_cntnc_at = #{outbrkSittnCntncAt}
                    , sittn_info_mssage = #{sittnInfoMssage}
                    , utmk_x = #{utmkX}
                    , utmk_y = #{utmkY}
                      , wkt_geom = #{wktGeom}
              WHERE
             accdnt_info_no = #{id}
    </update>

    <update id="updateAccdntInfoDynamic" parameterType="kr.or.lx.rcic.modules.accdntInfo.entity.AccdntInfo">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.updateAccdntInfoDynamic */

        UPDATE rcic.tl_accdnt_info
            <set>
            <if test="cntrwkAcdntSe != null and cntrwkAcdntSe != ''">
                cntrwk_acdnt_se = #{cntrwkAcdntSe},
            </if>
            <if test="esntlIdntfcNo != null and esntlIdntfcNo != ''">
                esntl_idntfc_no = #{esntlIdntfcNo},
            </if>
            <if test="cntrwkAcdntTy != null and cntrwkAcdntTy != ''">
                cntrwk_acdnt_ty = #{cntrwkAcdntTy},
            </if>
            <if test="cartrkIntrcpMth != null and cartrkIntrcpMth != ''">
                cartrk_intrcp_mth = #{cartrkIntrcpMth},
            </if>
            <if test="blockLaneCnt != null">
                block_lane_cnt = #{blockLaneCnt},
            </if>
            <if test="cntrwkBgnde != null and cntrwkBgnde != ''">
                cntrwk_bgnde = #{cntrwkBgnde},
            </if>
            <if test="cntrwkEndde != null and cntrwkEndde != ''">
                cntrwk_endde = #{cntrwkEndde},
            </if>
            <if test="cntrwkRealBeginTime != null and cntrwkRealBeginTime != ''">
                cntrwk_real_begin_time = #{cntrwkRealBeginTime},
            </if>
            <if test="cntrwkRealEndTime != null and cntrwkRealEndTime != ''">
                cntrwk_real_end_time = #{cntrwkRealEndTime},
            </if>
            <if test="outbrkSittnCntncAt != null and outbrkSittnCntncAt != ''">
                outbrk_sittn_cntnc_at = #{outbrkSittnCntncAt},
            </if>
            <if test="sittnInfoMssage != null and sittnInfoMssage != ''">
                sittn_info_mssage = #{sittnInfoMssage},
            </if>
            <if test="utmkX != null">
                utmk_x = #{utmkX},
            </if>
            <if test="utmkY != null">
                utmk_y = #{utmkY},
            </if>
            <if test="registDt != null">
                regist_dt = #{registDt},
            </if>
            <if test="wktGeom != null and wktGeom != ''">
                wkt_geom = #{wktGeom},
            </if>
            </set>
        WHERE
             accdnt_info_no = #{id}
    </update>

    <delete id="deleteAccdntInfo" parameterType="kr.or.lx.rcic.modules.accdntInfo.entity.AccdntInfo">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.deleteAccdntInfo */

        DELETE FROM rcic.tl_accdnt_info
        WHERE
             accdnt_info_no = #{id}
    </delete>

    <insert id="insertAccdntInfo">
        /* kr.or.lx.rcic.modules.accdntInfo.mapper.AccdntInfoMapper.insertAccdntInfo */
        INSERT INTO rcic.tl_accdnt_info
        (
        accdnt_info_no, cntrwk_acdnt_se, esntl_idntfc_no, cntrwk_acdnt_ty, cartrk_intrcp_mth, block_lane_cnt, cntrwk_bgnde, cntrwk_endde, cntrwk_real_begin_time, cntrwk_real_end_time, outbrk_sittn_cntnc_at, sittn_info_mssage, utmk_x, utmk_y, regist_dt, wkt_geom
        )
        VALUES (
        #{id},
        #{cntrwkAcdntSe},
        #{esntlIdntfcNo},
        #{cntrwkAcdntTy},
        #{cartrkIntrcpMth},
        #{blockLaneCnt},
        #{cntrwkBgnde},
        #{cntrwkEndde},
        #{cntrwkRealBeginTime},
        #{cntrwkRealEndTime},
        #{outbrkSittnCntncAt},
        #{sittnInfoMssage},
        #{utmkX},
        #{utmkY},
        NOW(),
        #{wktGeom}
        )
	</insert>

</mapper>

