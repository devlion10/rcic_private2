<?xml version="1.0" encoding="UTF-8"?>
<!--
 ! Source code generated by Celerio, a Jaxio product.
 ! Documentation: http://www.jaxio.com/documentation/celerio/
 ! Follow us on twitter: @jaxiosoft
 ! Need commercial support ? Contact us: info@jaxio.com
 ! Template pack-rcic:src/main/resources/sqlmap/modules/SqlMap.e.vm.xml
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper">

    <resultMap id="userMyAreaResultMap" type="kr.or.lx.rcic.modules.userMyArea.entity.UserMyArea">
        <!-- 관심지역번호 -->
        <result property="myAreaNo" column="my_area_no"/>
        <!-- 사용자번호 -->
        <result property="userSeq" column="user_seq"/>
        <!-- 관심지역명 -->
        <result property="myAreaNm" column="my_area_nm"/>
        <!-- 센터X좌표 -->
        <result property="centerX" column="center_x"/>
        <!-- 센터Y좌표 -->
        <result property="centerY" column="center_y"/>
        <!-- 지도줌레벨 -->
        <result property="zoomLv" column="zoom_lv"/>
        <!-- 등록일시 -->
        <result property="registDt" column="regist_dt"/>
        <!-- 등록아이디 -->
        <result property="registId" column="regist_id"/>
        <!-- 수정일시 -->
        <result property="updtDt" column="updt_dt"/>
        <!-- 수정아이디 -->
        <result property="updtId" column="updt_id"/>
    </resultMap>

    <sql id="whereConditions">
        <where>
            <include refid="conditions" />
        </where>
    </sql>

    <sql id="conditions">
        <if test="myAreaNo != null">
            AND my_area_no = #{myAreaNo}
        </if>
        <if test="userSeq != null and userSeq != ''">
            AND user_seq = #{userSeq}
        </if>
        <if test="centerX != null">
            AND center_x = #{centerX}
        </if>
        <if test="centerY != null">
            AND center_y = #{centerY}
        </if>
        <if test="zoomLv != null">
            AND zoom_lv = #{zoomLv}
        </if>
        <if test="registDt != null and registDt.enabled == true">
            
            <if test="registDtEq != null and registDtEq != ''">
            AND regist_dt = STR_TO_DATE(#{registDtEq}, '%Y.%m.%d')
            </if>
            
            <if test="registDtFrom != null and registDtFrom != ''">
            AND regist_dt <![CDATA[ >= ]]> STR_TO_DATE(#{registDtFrom}, '%Y.%m.%d')
            </if>

            <if test="registDtTo != null and registDtTo != ''">
            AND regist_dt <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{registDtTo}, '%Y.%m.%d'), INTERVAL 1 DAY)
            </if>
        </if>
        <if test="registId != null and registId != ''">
            AND regist_id = #{registId}
        </if>
        <if test="updtDt != null and updtDt.enabled == true">
            
            <if test="updtDtEq != null and updtDtEq != ''">
            AND updt_dt = STR_TO_DATE(#{updtDtEq}, '%Y.%m.%d')
            </if>
            
            <if test="updtDtFrom != null and updtDtFrom != ''">
            AND updt_dt <![CDATA[ >= ]]> STR_TO_DATE(#{updtDtFrom}, '%Y.%m.%d')
            </if>

            <if test="updtDtTo != null and updtDtTo != ''">
            AND updt_dt <![CDATA[ < ]]> DATE_ADD(STR_TO_DATE(#{updtDtTo}, '%Y.%m.%d'), INTERVAL 1 DAY)
            </if>
        </if>
        <if test="updtId != null and updtId != ''">
            AND updt_id = #{updtId}
        </if>
        <if test="myAreaNm != null and myAreaNm != ''">
            AND my_area_nm = #{myAreaNm}
        </if>
    </sql>

    <select id="getUserMyArea" resultMap="userMyAreaResultMap">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.getUserMyArea */

        SELECT
            my_area_no, user_seq, my_area_nm, center_x, center_y, zoom_lv, regist_dt, regist_id, updt_dt, updt_id
        FROM rcic.tb_user_my_area
        WHERE
         my_area_no = #{myAreaNo}
         AND  user_seq = #{userSeq}
	</select>

    <select id="selectUserMyAreaCnt" resultType="int">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.simpleListUserMyAreaCnt */

        SELECT COUNT(*)
        FROM rcic.tb_user_my_area
        <include refid="whereConditions" />
    </select>

    
    <select id="selectUserMyAreaList" resultType="egovMap">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.selectUserMyAreaList */

        <include refid="common.headerRow"/>
        SELECT
            my_area_no, user_seq, my_area_nm, center_x, center_y, zoom_lv, regist_dt, regist_id, updt_dt, updt_id
        FROM rcic.tb_user_my_area
        <include refid="whereConditions" />
        order by my_area_no desc
        <include refid="common.footerRow"/>
	</select>

    <update id="updateUserMyArea" parameterType="kr.or.lx.rcic.modules.userMyArea.entity.UserMyArea">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.updateUserMyArea */

        UPDATE rcic.tb_user_my_area
       	 SET
               		my_area_nm = #{myAreaNm}
                    , center_x = #{centerX}
                    , center_y = #{centerY}
                    , zoom_lv = #{zoomLv}
                    , updt_dt = NOW()
                    , updt_id = #{updtId}
              WHERE
             my_area_no = #{myAreaNo}
             AND  user_seq = #{userSeq}
    </update>

    <update id="updateUserMyAreaDynamic" parameterType="kr.or.lx.rcic.modules.userMyArea.entity.UserMyArea">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.updateUserMyAreaDynamic */

        UPDATE rcic.tb_user_my_area
            <set>
            <if test="myAreaNm != null and myAreaNm != ''">
                my_area_nm = #{myAreaNm},
            </if>
            <if test="minX != null">
                center_x = #{centerX},
            </if>
            <if test="minY != null">
                center_y = #{centerY},
            </if>
            <if test="zoomLv != null">
                zoom_lv = #{zoomLv},
            </if>
            <if test="registDt != null">
                regist_dt = #{registDt},
            </if>
            <if test="registId != null and registId != ''">
                regist_id = #{registId},
            </if>
            <if test="updtDt != null">
                updt_dt = NOW(),
            </if>
            <if test="updtId != null and updtId != ''">
                updt_id = #{updtId},
            </if>
            </set>
        WHERE
             my_area_no = #{myAreaNo}
             AND  user_seq = #{userSeq}
    </update>

    <delete id="deleteUserMyArea" parameterType="kr.or.lx.rcic.modules.userMyArea.entity.UserMyArea">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.deleteUserMyArea */

        DELETE FROM rcic.tb_user_my_area
        WHERE
        	user_seq = #{userSeq}
        	<if test="chkMyAreaNoStr != null and chkMyAreaNoStr != ''">
			AND my_area_no in (<foreach collection="chkMyAreaNoArr" item="item" separator=",">#{item}</foreach>)
			</if>
    </delete>

    <insert id="insertUserMyArea">
        /* kr.or.lx.rcic.modules.userMyArea.mapper.UserMyAreaMapper.insertUserMyArea */
        <selectKey resultType="long" keyColumn="my_area_no" keyProperty="myAreaNo" order="BEFORE">
            SELECT nextval('rcic.sq_tb_user_my_area')
        </selectKey>
        
        INSERT INTO rcic.tb_user_my_area
        (
        my_area_no, user_seq, my_area_nm, center_x, center_y, zoom_lv, regist_dt, regist_id, updt_dt, updt_id
        )
        VALUES (
        #{myAreaNo},
        #{userSeq},
        #{myAreaNm},
        #{centerX},
        #{centerY},
        #{zoomLv},
        NOW(),
        #{registId},
        NOW(),
        #{updtId}
        )
	</insert>

</mapper>

