<?xml version="1.0" encoding="UTF-8"?>
<!--
 ! Source code generated by Celerio, a Jaxio product.
 ! Documentation: http://www.jaxio.com/documentation/celerio/
 ! Follow us on twitter: @jaxiosoft
 ! Need commercial support ? Contact us: info@jaxio.com
 ! Template pack-rcic:src/main/resources/sqlmap/modules/SqlMap.e.vm.xml
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.lx.rcic.modules.search.mapper.SearchMapper">

    <select id="getBmngSchListCnt" resultType="egovMap">

        select count(prmsn_dt) as cnt from tl_bmng_info
        where 1=1
        <if test='searchText != null and searchText != ""' >
            and
            (OCPY_LOC like '%' || #{searchText} || '%')
            OR  (PRMSN_NO like '%' || #{searchText} || '%')
        </if>

        <if test='startDt != null and endDt != null and dateSchGbn eq "prmsnDt".toString()'  >
            and  to_date(prmsn_dt,'YYYYMMDD')
            between  to_date(#{startDt},'YYYYMMDD') and to_date(#{endDt},'YYYYMMDD')

        </if>

        <if test='startDt != null and endDt != null and dateSchGbn eq "preDt".toString()'  >
            and  (to_date(work_st_dt ,'YYYYMMDD') between  to_date(#{startDt},'YYYYMMDD') and to_date(#{endDt},'YYYYMMDD') )
            and  (to_date(work_en_dt ,'YYYYMMDD') between  to_date(#{startDt},'YYYYMMDD') and to_date(#{endDt},'YYYYMMDD') )

        </if>

    </select>

    <select id="getBmngSchList" resultType="egovMap">

        select
                REQ_DT,REQ_TYPE,PRMSN_NO,PRMSN_DT
                ,MNGR_NM,STATE_CD,ROAD_TYPE,ROAD_NM
                ,OCPY_LOC,OCPY_AREA,OCPY_POS,OCPY_DUR
                ,WORK_ST_DT,WORK_EN_DT,OCPY_PER_INFO
            from tl_bmng_info
        where 1=1

        <if test='searchText != null and searchText != ""' >
            and
                (OCPY_LOC like '%' || #{searchText} || '%')
            OR  (PRMSN_NO like '%' || #{searchText} || '%')
        </if>

        <if test='startDt != null and endDt != null and dateSchGbn eq "prmsnDt".toString()'  >
            and  to_date(prmsn_dt,'YYYYMMDD')
            between  to_date(#{startDt},'YYYYMMDD') and to_date(#{endDt},'YYYYMMDD')
            order by   to_date(prmsn_dt,'YYYYMMDD') desc


        </if>

        <if test='startDt != null and endDt != null and dateSchGbn eq "preDt".toString()'  >
            and  (to_date(work_st_dt ,'YYYYMMDD') between  to_date(#{startDt},'YYYYMMDD') and to_date(#{endDt},'YYYYMMDD') )
            and  (to_date(work_en_dt ,'YYYYMMDD') between  to_date(#{startDt},'YYYYMMDD') and to_date(#{endDt},'YYYYMMDD') )
            order by   to_date(work_st_dt,'YYYYMMDD') desc


        </if>

        limit 10 offset (#{pageNum}*10-10)



    </select>

    <!--공간정보겟-->
    <select id="getGeomList" resultType="egovMap">

        select  public.st_geomfromtext(line_geom, 3857) from tl_bmng_analysis_info
    </select>

    <!--읍면동 코드 조회-->
    <select id="getEmdCdList" resultType="egovMap">

        select  emd_cd from tb_legaldong_emd where sgg_nm=#{sggNm} and emd_nm=#{emdNm}
    </select>

    <!--리 코드 조회-->
    <select id="getLiCdList" resultType="egovMap">

        select  li_nm,li_cd,emd_cd from tb_legaldong_li where li_nm=#{liNm} and emd_cd=#{emdCd}
    </select>

    <!--지적정보 pnu 포함조회-->
    <select id="getCnbdList" resultType="egovMap">

        select geom
        ,public.GeometryType(geom) as geom_type
        ,public.ST_AsGeoJSON(geom) as geo_geom,
        addr,jibun,sub_jibun,stdr_dt, pnu
              from public.tb_cbnd_info where pnu=#{pnu}
    </select>


    <select id="getGeomFromRn" resultType="egovMap">

        select juris_emd_cd
        ,emd_kor_nm
        ,sido_kor_nm
        ,sig_kor_nm
        ,road_nm
        ,road_cd
        ,buld_main_no
        ,undg_yn
        ,buld_sub_no
        ,post_cd
        ,buld_usage
        ,buld_mng_no
        ,sig_buld_nm
        ,adm_cd
        ,up_flr
        ,und_flr
        ,adm_kor_nm
        ,apt_yn
        ,buld_cnt
        ,dtl_buld_nm
        ,buld_nm_hist
        ,dtl_buld_nm_hist
        ,res_yn
        ,buld_center_x
        ,buld_center_y
        ,entr_x
        ,entr_y
        ,sido_eng_nm
        ,sig_eng_nm
        ,emd_eng_nm
        ,road_eng_nm
        ,emd_gb
        ,trans_resn_cd

        from rcic.tb_srch_addr where 1=1
        <if test='rn != null and rn != ""' >
            and  road_nm=#{rn}
        </if>
        <if test='buldMainNo != null and buldMainNo != ""' >
            and  buld_main_no=#{buldMainNo}
        </if>
        <if test='buldSubNo != null and buldSubNo != ""' >
            and  buld_sub_no=#{buldSubNo}
        </if>

    </select>
</mapper>