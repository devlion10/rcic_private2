<?xml version="1.0" encoding="UTF-8"?>
<!--
 ! Source code generated by Celerio, a Jaxio product.
 ! Documentation: http://www.jaxio.com/documentation/celerio/
 ! Follow us on twitter: @jaxiosoft
 ! Need commercial support ? Contact us: info@jaxio.com
 ! Template pack-rcic:src/main/resources/sqlmap/modules/SqlMap.e.vm.xml
-->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.lx.rcic.modules.dataapi.mapper.ApiBlockInfoMapper">

    <resultMap id="apiBlockInfoResultMap" type="kr.or.lx.rcic.modules.dataapi.entity.ApiBlockInfo">
        <!-- 일련넘버 -->
        <result property="id" column="seq_no"/>
        <!-- API사용자번호 -->
        <result property="apiUserNo" column="api_user_no"/>
        <!-- 차단/해제구분 -->
        <result property="blockSe" column="block_se"/>
        <!-- 차단/해제사유 -->
        <result property="blockReason" column="block_reason"/>
        <!-- 차단시작일 -->
        <result property="blockBeginDe" column="block_begin_de"/>
        <!-- 차단종료일 -->
        <result property="blockEndDe" column="block_end_de"/>
        <!-- 해제일자 -->
        <result property="relisDe" column="relis_de"/>
        <!-- 등록일시 -->
        <result property="registDt" column="regist_dt"/>
        <!-- 등록아이디 -->
        <result property="registId" column="regist_id"/>

        <result property="insttNm" column="instt_nm"/>
    </resultMap>

    <sql id="whereConditions">
        <where>
            <include refid="conditions" />
        </where>
    </sql>

    <sql id="conditions">
        <if test="id != null">
            AND b.seq_no = #{id}
        </if>
        <if test="apiUserNo != null">
            AND b.api_user_no = #{apiUserNo}
        </if>
        <if test="blockSe != null and blockSe != ''">
            AND b.block_se = #{blockSe}
        </if>
        <if test="blockReason != null and blockReason != ''">
            AND b.block_reason = #{blockReason}
        </if>
        <if test="relisDe != null and relisDe != ''">
            AND b.relis_de = #{relisDe}
        </if>
        <if test="registId != null and registId != ''">
            AND b.regist_id = #{registId}
        </if>
        <if test="searchBeginDe not in {null, ''} and searchEndDe not in {null, ''}">
            AND (#{searchBeginDe} between block_begin_de and block_end_de
                OR #{searchEndDe} between block_begin_de and block_end_de)
        </if>
        <if test="insttNm != null and insttNm != ''">
            AND u.instt_nm LIKE CONCAT('%',#{insttNm},'%')
        </if>
    </sql>

    <select id="getApiBlockInfo" resultMap="apiBlockInfoResultMap">
        /* kr.or.lx.rcic.modules.apiBlockInfo.mapper.ApiBlockInfoMapper.getApiBlockInfo */

        SELECT
                b.seq_no
                , b.api_user_no
                , b.block_se
                , b.block_reason
                , b.block_begin_de
                , b.block_end_de
                , b.relis_de
                , b.regist_dt
                , b.regist_id

                , u.instt_nm
                , u.api_crtfc_key
        FROM rcic.tb_api_block_info b
        JOIN tb_api_user u ON u.api_user_no = b.api_user_no
        WHERE
         seq_no = #{id}
	</select>

    <select id="selectApiBlockInfoCnt" resultType="int">
        /* kr.or.lx.rcic.modules.dataapi.mapper.ApiBlockInfoMapper.simpleListApiBlockInfoCnt */

        SELECT COUNT(*)
        FROM rcic.tb_api_block_info b
        JOIN tb_api_user u ON u.api_user_no = b.api_user_no
        <include refid="whereConditions" />
    </select>

    
    <select id="selectApiBlockInfoList" resultType="egovMap">
        /* kr.or.lx.rcic.modules.dataapi.mapper.ApiBlockInfoMapper.selectApiBlockInfoList */

        <include refid="common.headerRow"/>
        SELECT
                  b.seq_no
                , b.api_user_no
                , b.block_se
                , b.block_reason
                , b.block_begin_de
                , b.block_end_de
                , b.relis_de
                , b.regist_dt
                , b.regist_id

                , u.instt_nm
                , u.api_crtfc_key
                , u.srbde
        FROM rcic.tb_api_block_info b
        JOIN tb_api_user u ON u.api_user_no = b.api_user_no
        <include refid="whereConditions" />
        ORDER BY seq_no DESC
        <include refid="common.footerRow"/>
	</select>

    <update id="updateApiBlockInfo" parameterType="kr.or.lx.rcic.modules.dataapi.entity.ApiBlockInfo">
        /* kr.or.lx.rcic.modules.apiBlockInfo.mapper.ApiBlockInfoMapper.updateApiBlockInfo */

        UPDATE rcic.tb_api_block_info
        SET
               api_user_no = #{apiUserNo}
                    , block_se = #{blockSe}
                    , block_reason = #{blockReason}
                    , block_begin_de = #{blockBeginDe}
                    , block_end_de = #{blockEndDe}
                    , relis_de = #{relisDe}
                  WHERE
             seq_no = #{id}
    </update>

    <update id="updateApiBlockInfoDynamic" parameterType="kr.or.lx.rcic.modules.dataapi.entity.ApiBlockInfo">
        /* kr.or.lx.rcic.modules.dataapi.mapper.ApiBlockInfoMapper.updateApiBlockInfoDynamic */

        UPDATE rcic.tb_api_block_info
            <set>
            <if test="apiUserNo != null">
                api_user_no = #{apiUserNo},
            </if>
            <if test="blockSe != null and blockSe != ''">
                block_se = #{blockSe},
            </if>
            <if test="blockReason != null and blockReason != ''">
                block_reason = #{blockReason},
            </if>
            <if test="blockBeginDe != null and blockBeginDe != ''">
                block_begin_de = #{blockBeginDe},
            </if>
            <if test="blockEndDe != null and blockEndDe != ''">
                block_end_de = #{blockEndDe},
            </if>
            <if test="relisDe != null and relisDe != ''">
                relis_de = #{relisDe},
            </if>
            <if test="registDt != null">
                regist_dt = #{registDt},
            </if>
            <if test="registId != null and registId != ''">
                regist_id = #{registId},
            </if>
            </set>
        WHERE
             seq_no = #{id}
    </update>

    <delete id="deleteApiBlockInfo" parameterType="kr.or.lx.rcic.modules.dataapi.entity.ApiBlockInfo">
        /* kr.or.lx.rcic.modules.apiBlockInfo.mapper.ApiBlockInfoMapper.deleteApiBlockInfo */

        DELETE FROM rcic.tb_api_block_info
        WHERE
             seq_no = #{id}
    </delete>

    <insert id="insertApiBlockInfo">
        /* kr.or.lx.rcic.modules.apiBlockInfo.mapper.ApiBlockInfoMapper.insertApiBlockInfo */
        INSERT INTO rcic.tb_api_block_info
        (
        seq_no, api_user_no, block_se, block_reason, block_begin_de, block_end_de, relis_de, regist_dt, regist_id
        )
        VALUES (
        nextval('rcic.seq_tb_api_block_info'),
        #{apiUserNo},
        #{blockSe},
        #{blockReason},
        #{blockBeginDe},
        #{blockEndDe},
        #{relisDe},
        NOW(),
        #{registId}
        )
	</insert>

</mapper>

