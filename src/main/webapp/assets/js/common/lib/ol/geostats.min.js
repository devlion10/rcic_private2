!function(t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):geostats=t()}(function(){var V=function(t){return t};Array.prototype.indexOf||(Array.prototype.indexOf=function(t,s){if(null==this)throw new TypeError('"this" is null or not defined');var i=this.length>>>0;for(s=+s||0,Math.abs(s)===1/0&&(s=0),s<0&&(s+=i)<0&&(s=0);s<i;s++)if(this[s]===t)return s;return-1});return function(s){this.objectID="",this.separator=" - ",this.legendSeparator=this.separator,this.method="",this.precision=0,this.precisionflag="auto",this.roundlength=2,this.is_uniqueValues=!1,this.debug=!1,this.silent=!1,this.bounds=Array(),this.ranges=Array(),this.inner_ranges=null,this.colors=Array(),this.counter=Array(),this.stat_sorted=null,this.stat_mean=null,this.stat_median=null,this.stat_sum=null,this.stat_max=null,this.stat_min=null,this.stat_pop=null,this.stat_variance=null,this.stat_stddev=null,this.stat_cov=null,this.log=function(t,s){1!=this.debug&&null==s||console.log(this.objectID+"(object id) :: "+t)},this.setBounds=function(t){this.log("Setting bounds ("+t.length+") : "+t.join()),this.bounds=Array(),this.bounds=t},this.setSerie=function(t){this.log("Setting serie ("+t.length+") : "+t.join()),this.serie=Array(),this.serie=t,this.resetStatistics(),this.setPrecision()},this.setColors=function(t){this.log("Setting color ramp ("+t.length+") : "+t.join()),this.colors=t},this.doCount=function(){if(!this._nodata()){var t=this.sorted();for(this.counter=new Array,i=0;i<this.bounds.length-1;i++)this.counter[i]=0;for(j=0;j<t.length;j++){var s=this.getClass(t[j]);this.counter[s]++}}},this.setPrecision=function(t){if(void 0!==t&&(this.precisionflag="manual",this.precision=t),"auto"==this.precisionflag)for(var s=0;s<this.serie.length;s++){if(isNaN(this.serie[s]+"")||-1==(this.serie[s]+"").toString().indexOf("."))i=0;else var i=(this.serie[s]+"").split(".")[1].length;i>this.precision&&(this.precision=i)}20<this.precision&&(this.log("this.precision value ("+this.precision+') is greater than max value. Automatic set-up to 20 to prevent "Uncaught RangeError: toFixed()" when calling decimalFormat() method.'),this.precision=20),this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision),this.serie=this.decimalFormat(this.serie)},this.decimalFormat=function(t){for(var s,i=new Array,e=0;e<t.length;e++)s=t[e],!isNaN(parseFloat(s))&&isFinite(s)?i[e]=parseFloat(t[e]).toFixed(this.precision):i[e]=t[e];return i},this.setRanges=function(){for(this.ranges=Array(),i=0;i<this.bounds.length-1;i++)this.ranges[i]=this.bounds[i]+this.separator+this.bounds[i+1]},this.min=function(){if(!this._nodata())return this.stat_min=Math.min.apply(null,this.serie),this.stat_min},this.max=function(){return this.stat_max=Math.max.apply(null,this.serie),this.stat_max},this.sum=function(){if(!this._nodata()){if(null==this.stat_sum)for(this.stat_sum=0,i=0;i<this.pop();i++)this.stat_sum+=parseFloat(this.serie[i]);return this.stat_sum}},this.pop=function(){if(!this._nodata())return null==this.stat_pop&&(this.stat_pop=this.serie.length),this.stat_pop},this.mean=function(){if(!this._nodata())return null==this.stat_mean&&(this.stat_mean=parseFloat(this.sum()/this.pop())),this.stat_mean},this.median=function(){if(!this._nodata()){if(null==this.stat_median){this.stat_median=0;var t=this.sorted();t.length%2?this.stat_median=parseFloat(t[Math.ceil(t.length/2)-1]):this.stat_median=(parseFloat(t[t.length/2-1])+parseFloat(t[t.length/2]))/2}return this.stat_median}},this.variance=function(){if(round="undefined"==typeof round,!this._nodata()){if(null==this.stat_variance){for(var t=0,s=0;s<this.pop();s++)t+=Math.pow(this.serie[s]-this.mean(),2);this.stat_variance=t/this.pop(),1==round&&(this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))}return this.stat_variance}},this.stddev=function(t){if(t=void 0===t,!this._nodata())return null==this.stat_stddev&&(this.stat_stddev=Math.sqrt(this.variance()),1==t&&(this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_stddev},this.cov=function(t){if(t=void 0===t,!this._nodata())return null==this.stat_cov&&(this.stat_cov=this.stddev()/this.mean(),1==t&&(this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_cov},this.resetStatistics=function(){this.stat_sorted=null,this.stat_mean=null,this.stat_median=null,this.stat_sum=null,this.stat_max=null,this.stat_min=null,this.stat_pop=null,this.stat_variance=null,this.stat_stddev=null,this.stat_cov=null},this._nodata=function(){return 0==this.serie.length?(this.silent?this.log("[silent mode] Error. You should first enter a serie!",!0):this.log("Error. You should first enter a serie!"),1):0},this._hasNegativeValue=function(){for(i=0;i<this.serie.length;i++)if(this.serie[i]<0)return!0;return!1},this._hasZeroValue=function(){for(i=0;i<this.serie.length;i++)if(0===parseFloat(this.serie[i]))return!0;return!1},this.sorted=function(){return null==this.stat_sorted&&(0==this.is_uniqueValues?this.stat_sorted=this.serie.sort(function(t,s){return t-s}):this.stat_sorted=this.serie.sort(function(t,s){var i=t.toString().toLowerCase(),e=s.toString().toLowerCase();return i<e?-1:e<i?1:0})),this.stat_sorted},this.info=function(){if(!this._nodata()){var t="";return t+=V("Population")+" : "+this.pop()+" - ["+V("Min")+" : "+this.min()+" | "+V("Max")+" : "+this.max()+"]\n",t+=V("Mean")+" : "+this.mean()+" - "+V("Median")+" : "+this.median()+"\n",t+=V("Variance")+" : "+this.variance()+" - "+V("Standard deviation")+" : "+this.stddev()+" - "+V("Coefficient of variation")+" : "+this.cov()+"\n"}},this.setClassManually=function(s){if(!this._nodata()){if(s[0]===this.min()&&s[s.length-1]===this.max())return this.setBounds(s),this.setRanges(),this.method=V("manual classification")+" ("+(s.length-1)+" "+V("classes")+")",this.bounds;this.silent?this.log("[silent mode] "+t("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()),!0):alert(V("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()))}},this.getClassEqInterval=function(t,s,e){if(!this._nodata()){var n=void 0===s?this.min():s,a=void 0===e?this.max():e,r=Array(),o=n,h=(a-n)/t;for(i=0;i<=t;i++)r[i]=o,o+=h;return r[t]=a,this.setBounds(r),this.setRanges(),this.method=V("eq. intervals")+" ("+t+" "+V("classes")+")",this.bounds}},this.getQuantiles=function(t){for(var s=this.sorted(),i=[],e=this.pop()/t,n=1;n<t;n++){var a=Math.round(n*e+.49);i.push(s[a-1])}return i},this.getClassQuantile=function(t){if(!this._nodata()){var s=this.sorted(),i=this.getQuantiles(t);return i.unshift(s[0]),i[s.length-1]!==s[s.length-1]&&i.push(s[s.length-1]),this.setBounds(i),this.setRanges(),this.method=V("quantile")+" ("+t+" "+V("classes")+")",this.bounds}},this.getClassStdDeviation=function(t,s){if(!this._nodata()){this.max(),this.min();var e=Array();if(t%2==1){var n=Math.floor(t/2),a=n+1;for(e[n]=this.mean()-this.stddev()/2,e[a]=this.mean()+this.stddev()/2,i=n-1;0<i;i--){var r=e[i+1]-this.stddev();e[i]=r}for(i=a+1;i<t;i++)r=e[i-1]+this.stddev(),e[i]=r}else{var o=t/2;for(e[o]=this.mean(),i=o-1;0<i;i--)r=e[i+1]-this.stddev(),e[i]=r;for(i=o+1;i<t;i++)r=e[i-1]+this.stddev(),e[i]=r}return e[0]=void 0===s?e[1]-this.stddev():this.min(),e[t]=void 0===s?e[t-1]+this.stddev():this.max(),this.setBounds(e),this.setRanges(),this.method=V("std deviation")+" ("+t+" "+V("classes")+")",this.bounds}},this.getClassGeometricProgression=function(t){if(!this._nodata()){if(!this._hasNegativeValue()&&!this._hasZeroValue()){var s=Array(),e=this.min(),n=this.max(),a=Math.log(n)/Math.LN10,r=Math.log(e)/Math.LN10,o=(a-r)/t;for(i=0;i<t;i++)0==i?s[i]=r:s[i]=s[i-1]+o;return(s=s.map(function(t){return Math.pow(10,t)})).push(this.max()),this.setBounds(s),this.setRanges(),this.method=V("geometric progression")+" ("+t+" "+V("classes")+")",this.bounds}this.silent?this.log("[silent mode] "+V("geometric progression can't be applied with a serie containing negative or zero values."),!0):alert(V("geometric progression can't be applied with a serie containing negative or zero values."))}},this.getClassArithmeticProgression=function(t){if(!this._nodata()){var s=0;for(i=1;i<=t;i++)s+=i;var e=Array(),n=this.min(),a=(this.max()-n)/s;for(i=0;i<=t;i++)0==i?e[i]=n:e[i]=e[i-1]+i*a;return this.setBounds(e),this.setRanges(),this.method=V("arithmetic progression")+" ("+t+" "+V("classes")+")",this.bounds}},this.getClassJenks=function(t){if(!this._nodata()){dataList=this.sorted();for(var s=[],i=0,e=dataList.length+1;i<e;i++){for(var n=[],a=0,r=t+1;a<r;a++)n.push(0);s.push(n)}for(var o=[],h=0,l=dataList.length+1;h<l;h++){for(var u=[],d=0,c=t+1;d<c;d++)u.push(0);o.push(u)}for(var g=1,f=t+1;g<f;g++){s[0][g]=1,o[0][g]=0;for(var p=1,v=dataList.length+1;p<v;p++)o[p][g]=1/0;var m=0}for(var _=2,b=dataList.length+1;_<b;_++){for(var x=0,y=0,F=0,M=1,C=_+1;M<C;M++){var w=_-M+1,A=parseFloat(dataList[w-1]);m=(y+=A*A)-(x+=A)*x/(F+=1);var S=w-1;if(0!=S)for(var L=2,j=t+1;L<j;L++)o[_][L]>=m+o[S][L-1]&&(s[_][L]=w,o[_][L]=m+o[S][L-1])}s[_][1]=1,o[_][1]=m}var q=dataList.length,E=[];for(h=0;h<=t;h++)E.push(0);E[t]=parseFloat(dataList[dataList.length-1]),E[0]=parseFloat(dataList[0]);for(var P=t;2<=P;){var R=parseInt(s[q][P]-2);E[P-1]=dataList[R],q=parseInt(s[q][P]-1),P-=1}return E[0]==E[1]&&(E[0]=0),this.setBounds(E),this.setRanges(),this.method=V("Jenks")+" ("+t+" "+V("classes")+")",this.bounds}},this.getClassUniqueValues=function(){if(!this._nodata()){this.is_uniqueValues=!0;var t=this.sorted(),s=Array();for(i=0;i<this.pop();i++)-1===s.indexOf(t[i])&&s.push(t[i]);return this.bounds=s,this.method=V("unique values"),s}},this.getClass=function(t){for(i=0;i<this.bounds.length;i++)if(1==this.is_uniqueValues){if(t==this.bounds[i])return i}else if(parseFloat(t)<=this.bounds[i+1])return i;return V("Unable to get value's class.")},this.getRanges=function(){return this.ranges},this.getRangeNum=function(t){var s,i;for(i=0;i<this.ranges.length;i++)if(s=this.ranges[i].split(/ - /),t<=parseFloat(s[1]))return i},this.getInnerRanges=function(){if(null!=this.inner_ranges)return this.inner_ranges;var t=new Array,s=this.sorted(),e=1;for(i=0;i<s.length;i++){if(0==i)var n=s[i];if(parseFloat(s[i])>parseFloat(this.bounds[e])&&(t[e-1]=""+n+this.separator+s[i-1],n=s[i],e++),e==this.bounds.length-1)return t[e-1]=""+n+this.separator+s[s.length-1],this.inner_ranges=t,this.inner_ranges}},this.getSortedlist=function(){return this.sorted().join(", ")},this.getHtmlLegend=function(t,s,e,n,a,r){var o="",h=new Array;if(this.doCount(),ccolors=null!=t?t:this.colors,lg=null!=s?s:"Legend",getcounter=null!=e,fn=null!=n?n:function(t){return t},null==a&&(a="default"),"discontinuous"!=a||(this.getInnerRanges(),-1===this.counter.indexOf(0))){if("DESC"!==r&&(r="ASC"),!(ccolors.length<this.ranges.length)){if(0==this.is_uniqueValues)for(i=0;i<this.ranges.length;i++){!0===getcounter&&(o=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>");var l=this.ranges[i].split(this.separator),u=parseFloat(l[0]).toFixed(this.precision),d=parseFloat(l[1]).toFixed(this.precision);"distinct"==a&&0!=i&&("number"!=typeof(f=u)||parseFloat(f)!=parseInt(f,10)||isNaN(f)?(u=parseFloat(u)+1/Math.pow(10,this.precision),u=parseFloat(u).toFixed(this.precision)):(u=parseInt(u)+1,"manual"==this.precisionflag&&0!=this.precision&&(u=parseFloat(u).toFixed(this.precision)))),"discontinuous"==a&&(l=this.inner_ranges[i].split(this.separator),u=parseFloat(l[0]).toFixed(this.precision),d=parseFloat(l[1]).toFixed(this.precision));var c=fn(u)+this.legendSeparator+fn(d),g='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+c+o+"</div>";h.push(g)}else for(i=0;i<this.bounds.length;i++)!0===getcounter&&(o=' <span class="geostats-legend-counter">('+this.counter[i]+")</span>"),c=fn(this.bounds[i]),g='<div><div class="geostats-legend-block" style="background-color:'+ccolors[i]+'"></div> '+c+o+"</div>",h.push(g);var f;"DESC"===r&&h.reverse();var p='<div class="geostats-legend"><div class="geostats-legend-title">'+V(lg)+"</div>";for(i=0;i<h.length;i++)p+=h[i];return p+="</div>"}this.silent?this.log("[silent mode] "+V("The number of colors should fit the number of ranges. Exit!"),!0):alert(V("The number of colors should fit the number of ranges. Exit!"))}else this.silent?this.log("[silent mode] "+V("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"),!0):alert(V("Geostats cannot apply 'discontinuous' mode to the getHtmlLegend() method because some classes are not populated.\nPlease switch to 'default' or 'distinct' modes. Exit!"))},this.objectID=(new Date).getUTCMilliseconds(),this.log("Creating new geostats object"),void 0!==s&&0<s.length?(this.serie=s,this.setPrecision(),this.log("Setting serie ("+s.length+") : "+s.join())):this.serie=Array(),this.getJenks=this.getClassJenks,this.getGeometricProgression=this.getClassGeometricProgression,this.getEqInterval=this.getClassEqInterval,this.getQuantile=this.getClassQuantile,this.getStdDeviation=this.getClassStdDeviation,this.getUniqueValues=this.getClassUniqueValues,this.getArithmeticProgression=this.getClassArithmeticProgression}});